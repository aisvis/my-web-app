<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Галерея с лайками</title>
    <style>
        /* Обновлённые стили */
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --overlay-bg: rgba(0, 0, 0, 0.9);
            --heart-color: #ff3250;
        }

        .gallery {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            /* Новое правило для лучшей адаптации */
            grid-auto-rows: minmax(200px, 250px);
        }

        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        /* Стили для лайков */
        .like-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 2;
        }

        .heart-icon {
            width: 32px;
            height: 32px;
            fill: #fff;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            transition: all 0.3s ease;
        }

        .heart-icon.liked {
            fill: var(--heart-color);
            transform: scale(1.2);
        }

        .likes-counter {
            position: absolute;
            bottom: 25px;
            right: 60px;
            color: white;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <!-- Остальная разметка без изменений -->

    <!-- Обновлённый лайтбокс -->
    <div class="lightbox">
        <span class="close-btn">&times;</span>
        <button class="nav-btn prev-btn">&lt;</button>
        <button class="nav-btn next-btn">&gt;</button>
        <div class="likes-counter">0</div>
        <button class="like-btn">
            <svg class="heart-icon" viewBox="0 0 24 24">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
        </button>
        <img class="lightbox-img" alt="Полноэкранное изображение">
    </div>

    <script>
        // Добавляем логику лайков
        let likes = JSON.parse(localStorage.getItem('galleryLikes')) || {};

        function updateLikesCounter(imgSrc) {
            const count = likes[imgSrc] || 0;
            document.querySelector('.likes-counter').textContent = count;
            const heart = document.querySelector('.heart-icon');
            heart.classList.toggle('liked', !!localStorage.getItem(`liked_${imgSrc}`));
        }

        // Обновляем обработчик открытия лайтбокса
        function openLightbox(index) {
            currentIndex = index;
            const imgSrc = galleryItems[index].querySelector('img').src;
            lightbox.classList.add('active');
            lightboxImg.src = imgSrc;
            updateLikesCounter(imgSrc);
        }

        // Обработчик лайка
        document.querySelector('.like-btn').addEventListener('click', function() {
            const imgSrc = lightboxImg.src;
            const isLiked = localStorage.getItem(`liked_${imgSrc}`);
            
            if(isLiked) {
                likes[imgSrc] = (likes[imgSrc] || 1) - 1;
                localStorage.removeItem(`liked_${imgSrc}`);
            } else {
                likes[imgSrc] = (likes[imgSrc] || 0) + 1;
                localStorage.setItem(`liked_${imgSrc}`, 'true');
            }
            
            localStorage.setItem('galleryLikes', JSON.stringify(likes));
            updateLikesCounter(imgSrc);
        });

        // Добавляем свайп-навигацию
        let touchStartX = 0;

        lightbox.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        lightbox.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].screenX;
            const deltaX = touchEndX - touchStartX;

            if(Math.abs(deltaX) > 50) {
                deltaX > 0 ? showPrev() : showNext();
            }
        });

        // Улучшенная мобильная вёрстка
        function updateGalleryLayout() {
            const gallery = document.querySelector('.gallery');
            if(window.innerWidth <= 480) {
                gallery.style.gridAutoFlow = 'dense';
                gallery.querySelectorAll('.gallery-item:nth-child(2n)').forEach(item => {
                    item.style.gridRow = 'span 2';
                });
            } else {
                gallery.style.gridAutoFlow = '';
                gallery.querySelectorAll('.gallery-item').forEach(item => {
                    item.style.gridRow = '';
                });
            }
        }

        window.addEventListener('resize', updateGalleryLayout);
        updateGalleryLayout();
    </script>
</body>
</html>
